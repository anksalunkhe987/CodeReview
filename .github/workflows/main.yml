name: Code review

on:
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v11.5
        with:
          separator: ","
          files: |
            ^sumup(-\w+)+-sapi\/
      
      - name: Get project name
        id: project-name
        run: |
          project_name=$(echo "${{ steps.changed-files.outputs.all_modified_files }}" | cut -d '/' -f 1 | xargs)
          echo "::set-output name=projectName::$project_name"
      
      - name: Code reiew of main Mule XML
        if: contains('/sumup-purchase-orders-sps-sapi/src/main/mule/sumup-purchase-orders-sps-sapi.xml', '/src/main/mule/')
        uses: ./codeReview/ # Uses an action in the root directory
        id: reviewMainXML
        with : 
          xml-file : ${{ steps.project-name.outputs.projectName }}/src/main/mule/*.xml
